extends layout_dashboard

block dashboardContent
  section
    div
      script
        | function handleSubmit(e) {
        |   e.preventDefault();
        |   window.location = '/dashboard/rooms/' + e.target[0].value;
        |   return false;
        | }
      form.roomSearch.form-inline.form-no-labels(onsubmit='return handleSubmit(...arguments);')
        .form-element
          input.form-input#room-search(type='text', placeholder='Room ID')
        .form-element
          input.button.button-outlined(type='submit', value='Find Room')
      br
      br

    ul
      li
        a(href='/dashboard/histograms/duration') Room Duration Stats
      li
        a(href='/dashboard/histograms/occupants') Room Occupants Stats
      li
        a(href='/dashboard/rooms') Recent Rooms

    table
      thead
        tr
          th(colspan=2)
          th Active
          th Last 24 hours
          th Last 7 days
      tbody
        tr
          th Rooms
          td Total
          td #{activeRoomCount}
          td #{prevDayRoomCount}
          td #{prevWeekRoomCount}
        tr
          td
          td Unique
          td #{activeRoomCount}
          td #{prevDayUniqueRoomCount}
          td #{prevWeekUniqueRoomCount}
        tr
          th Sessions
          td Total
          td #{sessionStats.total.active}
          td #{sessionStats.total.one_day}
          td #{sessionStats.total.week}
        tr
          td
          td Mobile
          td #{sessionStats.mobile.active}
          td #{sessionStats.mobile.one_day}
          td #{sessionStats.mobile.week}
        tr
          td
          td Web
          td #{sessionStats.web.active}
          td #{sessionStats.web.one_day}
          td #{sessionStats.web.week}
        tr
          th TURN-using Sessions
          td Total
          td -
          td #{sessionStats.total_turn.one_day} (#{(sessionStats.total_turn.one_day / (sessionStats.total.one_day || 1) * 100).toFixed(1)}%)
          td #{sessionStats.total_turn.week} (#{(sessionStats.total_turn.week / (sessionStats.total.week || 1) * 100).toFixed(1)}%)
        tr
          td
          td Mobile 
          td -
          td #{sessionStats.mobile_turn.one_day} (#{(sessionStats.mobile_turn.one_day / (sessionStats.mobile.one_day || 1) * 100).toFixed(1)}%)
          td #{sessionStats.mobile_turn.week} (#{(sessionStats.mobile_turn.week / (sessionStats.mobile.week || 1) * 100).toFixed(1)}%)
        tr
          td
          td Web 
          td -
          td #{sessionStats.web_turn.one_day} (#{(sessionStats.web_turn.one_day / (sessionStats.web.one_day || 1) * 100).toFixed(1)}%)
          td #{sessionStats.web_turn.week} (#{(sessionStats.web_turn.week / (sessionStats.web.week || 1) * 100).toFixed(1)}%)

    table
      thead
        tr
          th ICE Server
          th Bytes Sent
          th Bytes Received
          th Session Count
      tbody
        if iceUsage.length == 0
          tr
            td(colspan='4') No usage reported
        each iceServer in iceUsage
          tr
            td
              a(href='https://' + iceServer.server + ':8000') #{iceServer.server}
            td #{(parseInt(iceServer.sent, 10) / 1024 / 1024 / 1024).toFixed(3)} GB
            td #{(parseInt(iceServer.received, 10) / 1024 / 1024 / 1024).toFixed(3)} GB
            td #{iceServer.count}
        tr
          th Organization
          th(colspan='3')
        each iceOrg in iceOrgUsage
          tr
            td #{iceOrg.org}
            td #{(parseInt(iceOrg.sent, 10) / 1024 / 1024 / 1024).toFixed(3)} GB
            td #{(parseInt(iceOrg.received, 10) / 1024 / 1024 / 1024).toFixed(3)} GB
            td #{iceOrg.count}

    table
      thead
        tr
          th Workers
          th Queue Size
          th Queue Clock
      tbody
        tr
          td Events
          td #{eventQueue}
          td #{eventClock || '-'}
        tr
          td Room Reports
          td #{roomReportQueue}
          td #{roomReportClock || '-'}
        tr
          td ICE Usage
          td #{iceQueue}
          td #{iceClock || '-'}


